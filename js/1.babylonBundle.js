(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{28:function(t,e,i){"use strict";i.r(e),i.d(e,"DefaultSceneWithTexture",(function(){return M}));var n=i(39),r=i(104),a=i(31),o=i(117),s=i(120),c=i(51),f=i(209),h=(i(230),i(189)),l=i(165),u=["Hello There! This is an intentionally long line","HELLO","THERE","first","second","ANOTHER","ANOTHER",3,{a:1,b:[1,2,3]}],d=i(208),p=i(194),m=i(228);var g,x,y=function(t,e,i,n){return new(i||(i=Promise))((function(r,a){function o(t){try{c(n.next(t))}catch(t){a(t)}}function s(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}c((n=n.apply(t,e||[])).next())}))},w=function(t,e){var i,n,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};!function(t){t[t.xDirection=0]="xDirection",t[t.zDirection=1]="zDirection"}(g||(g={})),function(t){t[t.arrayMarker=0]="arrayMarker",t[t.objectMarker=1]="objectMarker"}(x||(x={}));function v(t,e,i){if(i===g.xDirection)t.xOffset=Math.max(t.xOffset,e.xOffset),t.zOffset+=e.zOffset;else{if(i!==g.zDirection)throw"Bad direction";t.xOffset+=e.xOffset,t.zOffset=Math.max(t.zOffset,e.zOffset)}}var O=function(){function t(t){this.json=t,this.lineHeight=20,this.xFudgeFactor=5,this.yFudgeFactor=2,this.totalWidth=1e3,this.totalHeight=1e4,this.frameCount=0,this.totalFutureSpriteCount=0,this.offset=this.lineHeight,this.frames=[],this.textToFrames=new Map,this.json=t}return t.prototype.maybeAddText=function(t){this.totalFutureSpriteCount++;var e=""+t;if(!this.textToFrames.has(e)){var i=Math.min(this.ctx.measureText(e).width+2*this.xFudgeFactor,100),n={filename:"sprite"+this.frameCount,frame:{x:0,y:this.offset-this.lineHeight+this.yFudgeFactor,w:i,h:this.lineHeight+this.yFudgeFactor},rotated:!1,trimmed:!1};this.textToFrames.set(e,{frame:n,textWidth:i}),this.frames.push(n),this.ctx.fillText(e,this.xFudgeFactor,this.offset),this.offset+=this.lineHeight,this.frameCount++}},t.prototype.makeTextForSpritesRec=function(t){var e=this;t instanceof Array?t.forEach((function(t){e.makeTextForSpritesRec(t)})):t instanceof Object?Object.keys(t).forEach((function(i){e.maybeAddText(i),e.makeTextForSpritesRec(t[i])})):this.maybeAddText(t)},t.prototype.makeTextForSprites=function(t){var e=document.createElement("canvas");e.width=this.totalWidth,e.height=this.totalHeight,this.ctx=e.getContext("2d"),this.ctx.font="22px Arial",this.ctx.fillStyle="steelblue",this.ctx.fillRect(0,0,this.totalWidth,this.totalHeight),this.ctx.fillStyle="#fff",this.makeTextForSpritesRec(this.json),this.spriteImage=e.toDataURL("image/png"),this.spriteAtlas={frames:this.frames},this.mySpritePackedManager=new h.a("spm",this.spriteImage,this.totalFutureSpriteCount,t,this.spriteAtlas),this.mySpritePackedManager.isPickable=!0},t}(),b=function(){function t(t,e,i){this.scene=t,this.spriteMgr=e,this.thinstanceMgr=i,this.spriteCount=0}return t.prototype.addSprite=function(t,e,i,n,r){if(this.spriteCount++,this.spriteCount>this.spriteMgr.totalFutureSpriteCount)throw"Trying to make more sprites than we figured!";var a=""+t,o=this.spriteMgr.textToFrames.get(a);if(!o)throw"Did not find text: "+a;var s=o.frame.filename,c=new l.a(s,this.spriteMgr.mySpritePackedManager);if(c.isPickable=!0,c.cellRef=s,c.width=o.textWidth/this.spriteMgr.lineHeight,r===g.xDirection)e+=c.width/2;else{if(r!==g.zDirection)throw"Bad direction";n+=c.width/2}if(c.position.x=e,c.position.y=i,c.position.z=n,r===g.xDirection)return{xOffset:c.width,zOffset:0};if(r===g.zDirection)return{xOffset:0,zOffset:c.width};throw"Bad direction"},t.prototype.displayJsonRec=function(t,e,i,n,r){var a=this,o={xOffset:0,zOffset:0};if(t instanceof Array)i-=2,t.forEach((function(t){var r=a.displayJsonRec(t,e,i,n+o.zOffset,g.xDirection);a.thinstanceMgr.addMarker(x.arrayMarker,e,i,n+o.zOffset,r),v(o,r,g.xDirection),o.zOffset+=2}));else{if(!(t instanceof Object))return this.addSprite(t,e,i,n,r);i-=2,Object.keys(t).forEach((function(r){var s=a.addSprite(r,e+o.xOffset,i,n,g.zDirection);a.thinstanceMgr.addMarker(x.objectMarker,e+o.xOffset,i,n,s);var c=a.displayJsonRec(t[r],e+o.xOffset,i,n+s.zOffset+.5,g.zDirection);a.thinstanceMgr.addMarker(x.objectMarker,e+o.xOffset,i,n+s.zOffset+.5,c);var f={xOffset:s.xOffset+c.xOffset,zOffset:s.zOffset+c.zOffset+.5};v(o,f,g.zDirection),o.xOffset+=2}))}return o},t.prototype.displayAndLayoutJson=function(){this.displayJsonRec(this.spriteMgr.json,0,0,0,g.xDirection),this.thinstanceMgr.makeInstances(this.scene)},t}(),k=function(){function t(){this.markers=[]}return t.prototype.makeInstances=function(t){var e=m.b.CreateBox("root",{size:1});this.box=e,e.thinInstanceEnablePicking=!0;for(var i=this.markers.length,n=new Float32Array(16*i),r=new Float32Array(4*i),o=a.a.Identity(),s=o._m,c=0;c<i;c++){var f=this.markers[c];s[0]=f.xLength||.5,s[5]=.5,s[10]=f.zLength||.5,s[12]=f.x+f.xLength/2,s[13]=f.y+1,s[14]=f.z+f.zLength/2,o.copyToArray(n,16*c),r[4*c+0]=f.kind===x.objectMarker?1:0,r[4*c+1]=0,r[4*c+2]=f.kind===x.arrayMarker?1:0,r[4*c+3]=1}e.thinInstanceSetBuffer("matrix",n,16,!1),e.thinInstanceSetBuffer("color",r,4,!1);var h=new m.i("material",t);h.disableLighting=!0,h.emissiveColor=m.c.White(),h.alpha=.5,e.material=h},t.prototype.addMarker=function(t,e,i,n,r){this.markers.push({kind:t,x:e,y:i,z:n,xLength:r.xOffset,zLength:r.zOffset})},t.prototype.getPositionOfInstance=function(t){var e=this.markers[t];return new a.e(e.x,e.y,e.z)},t}(),M=function(){function t(){var t=this;this.speed=45,this.frameCount=100,this.createScene=function(e,i){return y(t,void 0,void 0,(function(){var t,h,l,g;return w(this,(function(x){return this.engine=e,t=new n.a(e),this.scene=t,h=new r.a("my first camera",0,Math.PI/3,20,new a.e(0,0,0),t),this.camera=h,h.setTarget(a.e.Zero()),h.attachControl(i,!0),new o.a("light",new a.e(0,1,0),t).intensity=.7,l=s.a.CreateGround("ground",{width:6,height:6},t),g=new f.a("groundMaterial",t),l.material=g,this.displayJson(this.scene,u),this.listenForDroppedFiles(e,t,i),this.listenForNavigation(),function(t,e){var i=function(t,i,n){var r=new m.e("DynamicTexture",50,e,!0);r.hasAlpha=!0,r.drawText(t,5,40,"bold 36px Arial",i,"transparent",!0);var a=p.a.CreatePlane("TextPlane",{size:n},e),o=new c.a("TextPlaneMaterial",e);return a.material=o,o.backFaceCulling=!1,o.specularColor=new m.c(0,0,0),o.diffuseTexture=r,a};d.b.CreateLines("axisX",[m.j.Zero(),new m.j(t,0,0),new m.j(.95*t,.05*t,0),new m.j(t,0,0),new m.j(.95*t,-.05*t,0)],e).color=new m.c(1,0,0),i("X","red",t/10).position=new m.j(.9*t,-.05*t,0),d.b.CreateLines("axisY",[m.j.Zero(),new m.j(0,t,0),new m.j(-.05*t,.95*t,0),new m.j(0,t,0),new m.j(.05*t,.95*t,0)],e).color=new m.c(0,1,0),i("Y","green",t/10).position=new m.j(0,.9*t,-.05*t),d.b.CreateLines("axisZ",[m.j.Zero(),new m.j(0,0,t),new m.j(0,-.05*t,.95*t),new m.j(0,0,t),new m.j(0,.05*t,.95*t)],e).color=new m.c(0,0,1),i("Z","blue",t/10).position=new m.j(0,.05*t,.9*t)}(5,t),[2,t]}))}))}}return t.prototype.displayOrigin=function(){this.camera.target=new a.e(0,0,0),this.camera.position=new a.e(20,10,0),this.camera.update()},t.prototype.displayBottom=function(){var t=this.thinstanceMgr.box.getBoundingInfo().boundingBox.centerWorld;this.camera.target=t,this.camera.position=new a.e(t.x,t.y-20,t.z),this.camera.update()},t.prototype.getCameraInfoFromBoundingBox=function(t){var e=t.centerWorld.clone();e.y=t.minimumWorld.y;var i=t.maximumWorld.x-t.minimumWorld.x,n=t.maximumWorld.z-t.minimumWorld.z,r=this.engine.getRenderWidth(),a=this.engine.getRenderHeight(),o=this.camera.fov,s=(i/r>n/a?i/2:n/2)/Math.tan(o/2);if(s>=this.camera.maxZ)throw"Distance was too large";console.log("Diffs: x: "+i+", "+n+"  -- Also, screen width x height: "+r+" x "+a+" -- camera distance="+s);var c=e.clone();return c.y-=s,[e,c]},t.prototype.displayBottomSmart=function(){var t=this.thinstanceMgr.box.getBoundingInfo(),e=this.getCameraInfoFromBoundingBox(t.boundingBox),i=e[0],n=e[1];this.camera.position=n,this.camera.target=i,this.camera.update()},t.prototype.animateCameraTargetToPosition=function(t,e,i,n){var r=new m.d;r.setEasingMode(m.f.EASINGMODE_EASEINOUT),m.a.CreateAndStartAnimation("animateCameraTarget",t,"target",e,i,t.target,n,0,r).disposeOnEnd=!0},t.prototype.animateCameraToPosition=function(t,e,i,n){var r=new m.d;r.setEasingMode(m.f.EASINGMODE_EASEINOUT),m.a.CreateAndStartAnimation("animateCamera",t,"position",e,i,t.position,n,0,r).disposeOnEnd=!0},t.prototype.displayBottomWithAnimation=function(){var t=this.thinstanceMgr.box.getBoundingInfo().boundingBox.centerWorld,e=new a.e(t.x,t.y-20,t.z);this.animateCameraTargetToPosition(this.camera,this.speed,this.frameCount,t),this.animateCameraToPosition(this.camera,this.speed,this.frameCount,e)},t.prototype.listenForNavigation=function(){var t=this;this.scene.onKeyboardObservable.add((function(e){var i=e.event.key;if(e.type===m.h.KEYDOWN)switch(i){case"o":t.displayOrigin();break;case"d":t.displayBottomSmart()}}))},t.prototype.listenForDroppedFiles=function(t,e,i){var n=this,r=new m.g(t,e,null,null,null,null,null,null,null);r.onProcessFileCallback=function(t,e,i){return console.log("done: "+typeof t+" "+e+" "+i),n.loadAsText(t),!0},r.reload=function(){},r.monitorElementForDragNDrop(i)},t.prototype.loadAsText=function(t){var e=this,i=new FileReader;i.onload=function(t){if(t&&t.target){console.log("Read file: ",t.target.result.length);var i=JSON.parse(t.target.result);e.displayJson(e.scene,i)}},i.readAsText(t)},t.prototype.displayJson=function(t,e){var i=this,n=new O(e);n.makeTextForSprites(t);var r=new k;this.thinstanceMgr=r,new b(t,n,r).displayAndLayoutJson(),t.onPointerDown=function(t,e){if(e.pickedMesh&&e.thinInstanceIndex>=0){console.log("Got a thinstance!",e.thinInstanceIndex);var n=r.getPositionOfInstance(e.thinInstanceIndex);console.log("Setting targetPosition to "+n),i.camera.target=n,i.camera.update()}}},t}();e.default=new M}}]);
//# sourceMappingURL=1.babylonBundle.js.map